(()=>{"use strict";function t(t){return null!=t&&"object"==typeof t&&!0===t["@@functional/placeholder"]}function e(e){return function r(n){return 0===arguments.length||t(n)?r:e.apply(this,arguments)}}function r(t,e){return Object.prototype.hasOwnProperty.call(e,t)}var n=Object.prototype.toString;const a=function(){return"[object Arguments]"===n.call(arguments)?function(t){return"[object Arguments]"===n.call(t)}:function(t){return r("callee",t)}}(),i=Array.isArray||function(t){return null!=t&&t.length>=0&&"[object Array]"===Object.prototype.toString.call(t)};function s(t){return"[object String]"===Object.prototype.toString.call(t)}var o=e((function(t){return null!=t&&"function"==typeof t["fantasy-land/empty"]?t["fantasy-land/empty"]():null!=t&&null!=t.constructor&&"function"==typeof t.constructor["fantasy-land/empty"]?t.constructor["fantasy-land/empty"]():null!=t&&"function"==typeof t.empty?t.empty():null!=t&&null!=t.constructor&&"function"==typeof t.constructor.empty?t.constructor.empty():i(t)?[]:s(t)?"":function(t){return"[object Object]"===Object.prototype.toString.call(t)}(t)?{}:a(t)?function(){return arguments}():function(t){var e=Object.prototype.toString.call(t);return"[object Uint8ClampedArray]"===e||"[object Int8Array]"===e||"[object Uint8Array]"===e||"[object Int16Array]"===e||"[object Uint16Array]"===e||"[object Int32Array]"===e||"[object Uint32Array]"===e||"[object Float32Array]"===e||"[object Float64Array]"===e||"[object BigInt64Array]"===e||"[object BigUint64Array]"===e}(t)?t.constructor.from(""):void 0}));const c=o;function u(r){return function n(a,i){switch(arguments.length){case 0:return n;case 1:return t(a)?n:e((function(t){return r(a,t)}));default:return t(a)&&t(i)?n:t(a)?e((function(t){return r(t,i)})):t(i)?e((function(t){return r(a,t)})):r(a,i)}}}function l(t){for(var e,r=[];!(e=t.next()).done;)r.push(e.value);return r}function h(t,e,r){for(var n=0,a=r.length;n<a;){if(t(e,r[n]))return!0;n+=1}return!1}const d="function"==typeof Object.is?Object.is:function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e};var p=!{toString:null}.propertyIsEnumerable("toString"),f=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],b=function(){return arguments.propertyIsEnumerable("length")}(),m=function(t,e){for(var r=0;r<t.length;){if(t[r]===e)return!0;r+=1}return!1};const g="function"!=typeof Object.keys||b?e((function(t){if(Object(t)!==t)return[];var e,n,i=[],s=b&&a(t);for(e in t)!r(e,t)||s&&"length"===e||(i[i.length]=e);if(p)for(n=f.length-1;n>=0;)r(e=f[n],t)&&!m(i,e)&&(i[i.length]=e),n-=1;return i})):e((function(t){return Object(t)!==t?[]:Object.keys(t)}));const y=e((function(t){return null===t?"Null":void 0===t?"Undefined":Object.prototype.toString.call(t).slice(8,-1)}));function v(t,e,r,n){var a=l(t);function i(t,e){return S(t,e,r.slice(),n.slice())}return!h((function(t,e){return!h(i,e,t)}),l(e),a)}function S(t,e,n,a){if(d(t,e))return!0;var i,s,o=y(t);if(o!==y(e))return!1;if("function"==typeof t["fantasy-land/equals"]||"function"==typeof e["fantasy-land/equals"])return"function"==typeof t["fantasy-land/equals"]&&t["fantasy-land/equals"](e)&&"function"==typeof e["fantasy-land/equals"]&&e["fantasy-land/equals"](t);if("function"==typeof t.equals||"function"==typeof e.equals)return"function"==typeof t.equals&&t.equals(e)&&"function"==typeof e.equals&&e.equals(t);switch(o){case"Arguments":case"Array":case"Object":if("function"==typeof t.constructor&&"Promise"===(i=t.constructor,null==(s=String(i).match(/^function (\w*)/))?"":s[1]))return t===e;break;case"Boolean":case"Number":case"String":if(typeof t!=typeof e||!d(t.valueOf(),e.valueOf()))return!1;break;case"Date":if(!d(t.valueOf(),e.valueOf()))return!1;break;case"Error":return t.name===e.name&&t.message===e.message;case"RegExp":if(t.source!==e.source||t.global!==e.global||t.ignoreCase!==e.ignoreCase||t.multiline!==e.multiline||t.sticky!==e.sticky||t.unicode!==e.unicode)return!1}for(var c=n.length-1;c>=0;){if(n[c]===t)return a[c]===e;c-=1}switch(o){case"Map":return t.size===e.size&&v(t.entries(),e.entries(),n.concat([t]),a.concat([e]));case"Set":return t.size===e.size&&v(t.values(),e.values(),n.concat([t]),a.concat([e]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var u=g(t);if(u.length!==g(e).length)return!1;var l=n.concat([t]),h=a.concat([e]);for(c=u.length-1;c>=0;){var p=u[c];if(!r(p,e)||!S(e[p],t[p],l,h))return!1;c-=1}return!0}const _=u((function(t,e){return S(t,e,[],[])}));const A=e((function(t){return null!=t&&_(t,c(t))}));const E=e((function(t){return null==t}));const L=u((function(t,e){return!E(e)&&t in e}));const T=u((function(t,e){return e instanceof t||null!=e&&(e.constructor===t||"Object"===t.name&&"object"==typeof e)}));function j(r){return function n(a,i,s){switch(arguments.length){case 0:return n;case 1:return t(a)?n:u((function(t,e){return r(a,t,e)}));case 2:return t(a)&&t(i)?n:t(a)?u((function(t,e){return r(t,i,e)})):t(i)?u((function(t,e){return r(a,t,e)})):e((function(t){return r(a,i,t)}));default:return t(a)&&t(i)&&t(s)?n:t(a)&&t(i)?u((function(t,e){return r(t,e,s)})):t(a)&&t(s)?u((function(t,e){return r(t,i,e)})):t(i)&&t(s)?u((function(t,e){return r(a,t,e)})):t(a)?e((function(t){return r(t,i,s)})):t(i)?e((function(t){return r(a,t,s)})):t(s)?e((function(t){return r(a,i,t)})):r(a,i,s)}}}const I=j((function(t,e,r){return r.replace(t,e)}));function F(t,e){var r=t<0?e.length+t:t;return s(e)?e.charAt(r):e[r]}const C=e((function(t){return F(-1,t)})),D=Number.isInteger||function(t){return(t|0)===t};const O=u((function(t,e){return null==e||e!=e?t:e}));const P=j((function(t,e,r){return O(t,function(t,e){for(var r=e,n=0;n<t.length;n+=1){if(null==r)return;var a=t[n];r=D(a)?F(a,r):r[a]}return r}(e,r))})),U=t=>t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),w=t=>t.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&#0?39;/g,"'").replace(/&quot;/g,'"').replace(/&amp;/g,"&");function z(t,...e){if("string"==typeof t)return U(t);let r=t[0];for(const[n,a]of e.entries())r=r+U(String(a))+t[n+1];return r}function M(t,...e){if("string"==typeof t)return w(t);let r=t[0];for(const[n,a]of e.entries())r=r+w(String(a))+t[n+1];return r}class R extends HTMLUListElement{static get observedAttributes(){return["data-content","data-source-url"]}constructor(){super(),this.observer=null,this.template="",this.partials={},this.createdItems=[],this.sourceUrlFetchSent=!1,this.sourceUrlDataReceived=!1,this.pagination=null,this.apiReady=!1,this.shouldLazyLoad=!1,this.speciallyTreatedBuilderiusTags=["BUILDERIUS-COLLECTION"],this.dataContent=[],this.dataClearIdAttr=!1,this.dataSourceUrl="",this.dataSubscribeFormSelector="",this.dataSubscribeFormEvent="",this.dataEnableLazyLoad=!1,this.lastTimeData=null,this.dataSubscribeDataPath=null,this.colObserver=new IntersectionObserver((t=>{t.forEach((t=>{this.shouldLazyLoad&&t.isIntersecting&&this.onReadyCb()}))})),this.colObserver.observe(this),this.onReadyCb=()=>{R.isApiReady()&&((R.isBuilderMode()||!R.isBuilderMode()&&A(this.template))&&this._setTemplates(),this._subscribeToForm(),R.isBuilderMode()?setTimeout((()=>{this._subscribeToPagination()}),150):this._subscribeToPagination(),this._initiateScript())},document.addEventListener("builderius.frontend.api.ready",(()=>{this.onReadyCb()}),!1)}connectedCallback(){R.isBuilderMode()&&!this.shouldLazyLoad&&this.onReadyCb()}disconnectedCallback(){this._unsubscribeFromForm(),this._unsubscribeFromPagination(),document.removeEventListener("builderius.frontend.api.ready",(()=>{}),!1)}attributeChangedCallback(t){this._upgradeProperty(t)}_upgradeProperty(t){const e=this._camalize(t);if(L(e,this)){let t=this[e];delete this[e],this[e]=t}}_fromDataset(t,e=null,r=null){const n=E(e)?{...this.dataset}:{...e.dataset};return E(n[t])?r:n[t]}_inDataset(t,e=null){return t in(E(e)?{...this.dataset}:{...e.dataset})}set dataContent(t){R.isApiReady()&&this._initiateScript()}get dataContent(){const t=this._fromDataset("content",this,[]);return this._parseJson(t)}set dataGlobals(t){R.isApiReady()&&this._initiateScript()}get dataGlobals(){const t=this._fromDataset("globals");return this._parseJson(t)}set dataClearIdAttr(t){}get dataClearIdAttr(){return this._fromDataset("clearIdAttr")}set dataSourceUrl(t){this.isValidURL(t)&&R.isApiReady()&&!this.sourceUrlFetchSent&&!this.sourceUrlDataReceived&&(this.sourceUrlFetchSent=!0,this._getDataFromUrl())}get dataSourceUrl(){return this._fromDataset("sourceUrl")}set dataEnableLazyLoad(t){!0===t&&(this.shouldLazyLoad=!0)}get dataEnableLazyLoad(){return this._inDataset("enableLazyLoad")}_parseJson(t){let e={};if(T(Array,t))e=t.map((t=>this._parseJson(t)));else if(T(Object,t))for(let r in t)e[r]=this._parseJson(t[r]);else T(String,t)?(t=R.fromJson(t),e=T(Object,t)?this._parseJson(t):t):e=t;return e}isValidURL(t){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(t)}_setTemplates(){const t=this.querySelectorAll(":scope > template"),e=document.createElement("template");e.classList.add("uniParentTmpl"),e.setAttribute("data-section","."),[...t].length&&[...t].forEach((t=>{e.appendChild(t.cloneNode(!0))})),!R.isBuilderMode()&&[...t].length>0&&(this.innerHTML="");let r={};const n=this._traverseTmpl(e,r);r=Object.keys(r).reduce(((t,e)=>(T(Array,r[e])?t[e]=r[e].join(""):t[e]=r[e],t)),{}),this.partials=r,this.template=M(n);const a=new RegExp(/(data-expression+(-+[a-z]+)*="{{(.*?)}}"|data-expression+(-+[a-z]+)*="{{{(.*?)}}}")/g);A(this.partials)||Object.keys(this.partials).map((t=>{const e=this.partials[t].match(a);E(e)||e.map((e=>{const r=e.match(/{{.*?}}/);E(r)||(this.partials[t]=I(e,M(r[0]),this.partials[t]))}))}));const i=this.template.match(a);E(i)||i.map((t=>{const e=t.match(/{{.*?}}/);E(e)||(this.template=I(t,M(e[0]),this.template))}))}_uniqid(){return"e"+Math.random().toString(16).substring(2,8)}_traverseTmpl(t,e){const r=new RegExp('<[a-zA-Z]+[a-zA-Z-_:0-9]*( [a-zA-Z-_:0-9]+=".+")*\\/? *>'),{nodeType:n,nodeName:a}=t,{section:i,partial:s,partialName:o}={...t.dataset},{when:c=i,if:u=s,ifName:l=o}={...t.dataset},{source:h=c,condition:d=u,recursiveName:p=l}={...t.dataset};let f=[],b=null,m=null,g="";if(!E(t.hasAttributes)&&t.hasAttributes())for(const e of t.attributes)t.setAttribute(e.name,z(M(e.value)));if(1===n){["TEMPLATE"].includes(a)||(m=t.cloneNode(!0));let n=[];if(n="TEMPLATE"===a&&A([...t.children])&&!E(t.content)?[...t.content.childNodes]:[...t.childNodes],this.nodeName===a&&this.isSameNode(t)){const e=t.getAttribute("data-content");E(e)||(b=[...e].filter((t=>!_(t,"{")&&!_(t,"}"))).join(""),f.push(`{{> ${b}}}`))}else if("TEMPLATE"===a)t.classList.contains("uniParentTmpl")?f.push("{{#.}}"):E(d)&&E(p)?E(h)||f.push(`{{#${h}}}`):(b=E(p)?this._uniqid():p,E(d)?f.push(`{{> ${b}}}`):f.push(`{{> ${d} ? "${b}" : ""}}`));else if(this.speciallyTreatedBuilderiusTags.includes(a)&&!E(m)){const t=m.innerHTML;m.innerHTML="";const e=m.outerHTML.match(r);g=E(e)||A(e)?"":e[0],f.push(g),f.push("{{=<%% %%>=}}"),f.push(t),n=[]}else if(A(n)||E(n)||E(m))f.push(t.outerHTML);else{const t=m.getAttribute("is");if(!E(t)&&t.match("builderius"))for(const t of m.attributes)if(!["data-content","data-globals","data-tab","data-tab-panel"].includes(t.name)){const e=t.value.match(/{{.*?}}/);if(!E(e)){const e=this._uniqid();this.specs[e]=t.value,m.setAttribute(t.name,`{{${e}}}`)}}m.innerHTML="";const e=m.outerHTML.match(r);g=E(e)||A(e)?"":e[0],f.push(g)}if(n.reduce(((t,r)=>{let n=this._traverseTmpl(r,e);E(d)||E(h)||(n=`{{#${h}}}${n}{{/${h}}}`),E(b)?f.push(n):(E(e[b])&&(e[b]=[]),e[b].push(n))}),{}),"TEMPLATE"===a)t.classList.contains("uniParentTmpl")?f.push("{{/.}}"):!E(h)&&E(d)&&f.push(`{{/${h}}}`);else if(this.speciallyTreatedBuilderiusTags.includes(a)&&!E(m)){f.push("<%%={{ }}=%%>"),m.innerHTML="";const t=C(m.outerHTML.split(g).filter((t=>t)));f.push(t)}else if(!A(n)&&!E(n)&&!E(m)){m.innerHTML="";const t=C(m.outerHTML.split(g).filter((t=>t)));f.push(t)}}else 3===n&&f.push(t.nodeValue);return f.join("")}_getFormEvent(){const t=this._fromDataset("subscribeFormEvent");return!E(t)&&["oninput","onsubmit","onsuccess","onfail","ondisable"].includes(this.dataSubscribeFormEvent)?t:"oninput"}_subscribeToForm(){if(this.dataSubscribeFormSelector=this._fromDataset("subscribeFormSelector"),this.dataSubscribeFormEvent=this._getFormEvent(),this.dataSubscribeDataPath=this._fromDataset("subscribeDataPath"),this.dataSubscribeFormSelector&&this.dataSubscribeFormEvent&&["oninput","onsubmit","onsuccess","onfail","ondisable"].includes(this.dataSubscribeFormEvent)){[...document.querySelectorAll(this.dataSubscribeFormSelector)].forEach((t=>t.addEventListener(`builderius-smartform-${this.dataSubscribeFormEvent}`,(t=>{const e=E(this.dataSubscribeDataPath)?t.detail.data:P({},this.dataSubscribeDataPath.split("."),t.detail.data);_(JSON.stringify(e),this.lastTimeData)?this._dispatchEvent("equal-data",{el:this}):(this.lastTimeData=JSON.stringify(e),this.setAttribute("data-content",JSON.stringify(e)))}))))}}_subscribeToPagination(){this.dataSubscribePaginationSelector=this._fromDataset("subscribePaginationSelector");const t=document.querySelector(this.dataSubscribePaginationSelector);(E(this.pagination)&&t||t&&!t.isSameNode(this.pagination))&&(this.pagination=t,this.pagination.addEventListener("builderius-pagination-change",(()=>{this._initiateScript()})))}_unsubscribeFromForm(){if(this.dataSubscribeFormSelector=this._fromDataset("subscribeFormSelector"),this.dataSubscribeFormEvent=this._fromDataset("subscribeFormEvent"),this.dataSubscribeFormSelector&&this.dataSubscribeFormEvent&&["oninput","onsubmit","onsuccess","onfail","ondisable"].includes(this.dataSubscribeFormEvent)){[...document.querySelectorAll(this.dataSubscribeFormSelector)].forEach((t=>t.removeEventListener(`builderius-smartform-${this.dataSubscribeFormEvent}`,(()=>{}))))}}_unsubscribeFromPagination(){this.pagination&&this.pagination.removeEventListener("builderius-pagination-change",(()=>{this._initiateScript()}))}_getDataFromUrl(){try{fetch(this.dataSourceUrl).then((t=>t.json())).then((t=>{this.sourceUrlDataContent=t,this.sourceUrlDataReceived=!0,this._initiateScript()}))}catch(t){console.error(t)}}_getProperDataContent(){return this.sourceUrlDataReceived?this.sourceUrlDataContent:T(String,this.dataContent)?JSON.parse(this.dataContent):this.dataContent}_initiateScript(){try{if(A(this.template)&&(this._setTemplates(),A(this.template)))throw new Error("Builderius: no template yet");if(!A(this.dataSourceUrl)&&!E(this.dataSourceUrl)&&!this.isValidURL(this.dataSourceUrl))throw new Error("Builderius: invalid source url");const t=this._getProperDataContent();this.pagination&&!E(this.pagination.setTotalItems)&&T(Array,t)&&(this.pagination.setTotalItems(t.length),this.pagination.collRef=this);const e=this._render();if(!E(e))throw new Error(e);this._dispatchEvent("ready",{el:this})}catch(t){return t}}_render(){try{const t=this._getProperDataContent();if(!E(t)){const e=P(null,["Builderius","API","helpers","mustache"],window);let r=this._getItemsPerPage();if(!E(e)&&T(Array,r)){const n=e.render(this.template,r,this.partials,{globals:this.dataGlobals});this._appendHtml(n),this._dispatchEvent("rendered",{el:this,content:t})}else this._removeItems()}}catch(t){return t}}_appendHtml(t){const e=this._getProperDataContent();let r=this;let n=document.createElement("div");n.insertAdjacentHTML("afterbegin",t),n=this._clearItem(n),this._removeItems(),[...n.children].forEach((t=>{this._addItem(t),r.appendChild(t)})),this._dispatchEvent("appended-html",{el:this,content:e})}_clearItem(t){const e=["data-uni-node","data-uni-name","data-uni-label","data-uni-parents"];if(this.dataClearIdAttr&&e.push("id"),R.isBuilderMode()){const e=t.getAttribute("data-uni-node");t.setAttribute("data-uni-origin-mod",e);const r=t.getAttribute("data-uni-label");t.setAttribute("data-uni-origin-label",r)}if(e.forEach((e=>t.removeAttribute(e))),[...t.classList].forEach((e=>{E(e.match(/^uni(?!(-node|-[A-Z]))/))&&E(e.match(/builderius/))||t.classList.remove(e)})),A(t.classList)&&t.removeAttribute("class"),!E(t.hasAttributes)&&t.hasAttributes())for(const e of t.attributes)E(e.value)||t.setAttribute(e.name,M(e.value));const r=[...t.children];return A(r)||r.map((e=>{const r=this._clearItem(e);t.replaceChild(r,e)})),t}_addItem(t){this.createdItems.push(t)}_removeItems(){this.createdItems.map((t=>t.remove())),this.createdItems=[]}_getItemsPerPage(){const t=this._getProperDataContent();if(this.pagination&&!E(this.pagination.getData)&&T(Array,t)){const{perPage:e,current:r}=this.pagination.getData();if(0<r&&t.length>e){const n=(r-1)*e,a=t.slice(n,n+e);return A(a)?t:a}return t}return t}_camalize(t){return t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,((t,e)=>e.toUpperCase()))}_dispatchEvent(t,e=null){const r={bubbles:!1,cancelable:!0,detail:e},n=new CustomEvent(t,r),a=new CustomEvent(`builderius-collection-ul-${t}`,r);this.dispatchEvent(n),window.dispatchEvent(a)}reInit(){R.isBuilderMode()&&(this.template="",this.partials={});const t=P(null,["Builderius","initiateInteractivity"],window);t&&t(),this._initiateScript()}testComponent(){return this.template="",this.partials={},this._initiateScript()}static fromJson(t){let e={};if(T(String,t))try{e=JSON.parse(M(t))}catch(e){return t}return e}static isApiReady(){const t=P(null,["Builderius","API","helpers"],window);return!E(t)&&!A(t)}static isBuilderMode(){return!1!==P(!1,["BuilderiusInner"],window)}}void 0===customElements.get("builderius-collection-ul")&&customElements.define("builderius-collection-ul",R,{extends:"ul"})})();